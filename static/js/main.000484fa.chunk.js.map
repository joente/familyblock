{"version":3,"sources":["serviceWorker.js","AnimateMoveUp.js","AnimateMerge.js","Cell.js","Highlight.js","Grid.js","Tile.js","Tiles.js","Score.js","index.js","Game.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","AnimateMoveUp","tile","toCell","unit","move","target","speed","normalize","getYpos","size","width","height","animate","container","position","y","setTile","AnimateMerge","withCell","direction","getXpos","done","x","remove","nextTile","Cell","stage","pos","col","row","cellTexture","bg","PIXI","cellpos","animation","addChild","resize","visible","isEmpty","hide","newTile","getValue","value","getIndex","index","getTile","moveTileUp","mergeTile","parent","Highlight","offset","ok","nok","sprite","update","newCol","newSprite","Grid","score","tiles","w","h","cells","from","okTexture","nokTexture","highlight","isAnimating","targetIndex","push","lastRow","rows","forEach","cell","colOnGrid","mpos","Math","floor","colOkNok","undefined","select","cellsToAnimate","colsMoved","addMovedCol","includes","processGrid","length","reduce","total","toList","Array","fill","r","i","n","ce","cols","splice","ma","cidx","nextTarget","mi","final","cb","addTile","Tile","allTiles","str","color","graphics","style","fontFamily","fontSize","fontWeight","align","stroke","strokeThickness","lineJoin","text","isSmall","clear","lineStyle","beginFill","drawRoundedRect","endFill","dupTile","removeChild","Tiles","numTiles","rasterTexture","currentRaster","nextRaster","minTileIndex","randColor","random","current","next","normalizeTiles","tileByIndex","idx","renderTiles","diff","getRandomTile","getCurrentTile","stealCurrentTile","Score","fontStyle","toLocaleString","game","app","innerWidth","innerHeight","appendChild","view","renderer","display","backgroundColor","autoResize","interactive","placeTile","grid","on","event","data","getLocalPosition","ww","wh","dropShadow","dropShadowAlpha","dropShadowAngle","dropShadowBlur","dropShadowColor","dropShadowDistance","skew","set","anchor","requestAnimationFrame","render","Game","document","body","URL","process","href","origin","addEventListener","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.000484fa.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","const AnimateMoveUp = (state) => {\n    const {tile, toCell, unit} = state;\n\n    let move = {\n        target: 0,\n        speed: -1,\n    }\n\n    const normalize = () => {\n        move.target = toCell.getYpos();\n        move.speed = -5.0*unit.size;\n        tile.width = 10*unit.size;\n        tile.height = 10*unit.size;\n    }\n\n    normalize();\n\n    const animate = () => {\n        tile.container.position.y += move.speed;\n        if (tile.container.position.y <= move.target) {\n            toCell.setTile(tile);\n            return true;  // finished\n        }\n        return false;  // not finished\n    }\n    return {\n        animate,\n        normalize,\n    };\n}\n\nexport default AnimateMoveUp;","const AnimateMerge = (state) => {\n    const {tile, withCell, direction, unit} = state;\n\n    let move = {\n        target: 0,\n        speed: 0,\n    }\n\n    const normalize = () => {\n        switch (direction) {\n        case \"up\":\n            move.target = withCell.getYpos();\n            break;\n        case \"right\":\n        case \"left\":\n            move.target = withCell.getXpos();\n            break;\n        default:\n            console.log(\"unknown direction: \", direction);\n        }\n\n        move.speed = 1*unit.size;  // normal speed; 1\n        tile.width = 10*unit.size;\n        tile.height = 10*unit.size;\n    }\n\n    normalize();\n\n    const animate = () => {\n        let done = false;\n\n        switch (direction) {\n        case \"up\":\n            tile.container.position.y += move.speed;\n            done = tile.container.position.y >= move.target;\n            break;\n        case \"right\":\n            tile.container.position.x += move.speed;\n            done = tile.container.position.x >= move.target;\n            break;\n        case \"left\":\n            tile.container.position.x -= move.speed;\n            done = tile.container.position.x <= move.target;\n            break;\n        default:\n            console.log(\"unknown direction: \", direction);\n        }\n        if (done) {\n            tile.remove();\n            withCell.nextTile();\n            return true;  // finished\n        }\n        return false;  // not finished\n    }\n    return {\n        animate,\n        normalize,\n    };\n}\n\nexport default AnimateMerge;","import * as PIXI from \"pixi.js\";\nimport AnimateMoveUp from \"./AnimateMoveUp\";\nimport AnimateMerge from \"./AnimateMerge\";\n\n\nconst Cell = (state) => {\n    const {stage, pos, unit, col, row, cellTexture} = state;\n    const bg = new PIXI.Sprite(cellTexture);\n    const cellpos = {x: 0, y: 0, size: 0};\n\n    let tile = null;\n    let animation = null;\n\n    const normalize = () => {\n        cellpos.x = pos.x + unit.size*10*col;\n        cellpos.y = pos.y + unit.size*10*row;\n        cellpos.size = 10*unit.size;\n\n        if (bg.visible) {\n            bg.position.x = cellpos.x;\n            bg.position.y = cellpos.y;\n            bg.width = bg.height = cellpos.size;\n        }\n\n        if (tile !== null) {\n            tile.container.position.x = cellpos.x;\n            tile.container.position.y = cellpos.y;\n            tile.normalize();\n        }\n\n        if (animation !== null) {\n            animation.normalize();\n        }\n    }\n\n    stage.addChild(bg);\n\n    return {\n        col,\n        row,\n        resize: normalize,\n        isEmpty: () => tile === null,\n        hide: () => bg.visible = false,\n        setTile: (newTile) => {\n            if (tile) {\n                tile.remove();\n            }\n            tile = newTile;\n            tile.container.position.x = cellpos.x;\n            tile.container.position.y = cellpos.y;\n        },\n        animate: () => {\n            if (animation) {\n                if (animation.animate() === true) {\n                    animation = null;  // finished;\n                }\n            }\n            return animation === null;  // true when finished or nothing to animate\n        },\n        getValue: () => tile === null ? 0 : tile.value,\n        getIndex: () => tile === null ? null : tile.index,\n        getXpos: () => pos.x + unit.size*10*col,\n        getYpos: () => pos.y + unit.size*10*row,\n        getTile: () => tile,\n        moveTileUp: (toCell) => {\n            animation = AnimateMoveUp({toCell, tile, unit});\n            tile = null;\n        },\n        mergeTile: (withCell, direction) => {\n            animation = AnimateMerge({withCell, direction, tile, unit});\n            tile = null;\n        },\n        nextTile: () => {\n            if (tile !== null) {\n                const nextTile = tile.nextTile();\n                tile.container.parent.addChild(nextTile.container);\n                tile.remove();\n                tile = nextTile;\n                tile.container.position.x = cellpos.x;\n                tile.container.position.y = cellpos.y;\n            } else {\n                console.log(\"tile is null when calling `nextTile()`\");\n            }\n        }\n    }\n};\n\nexport default Cell;","const Highlight = (state) => {\n    const {offset, ok, nok, unit} = state;\n\n    let sprite = ok;\n    let col = null;\n\n    const normalize = () => {\n        if (col === null) {\n            ok.visible = false;\n            nok.visible = false;\n            return;\n        }\n        sprite.visible = true;\n        sprite.position.x = offset.x + 4*unit.size + col*10*unit.size;\n        sprite.position.y = offset.y + 9*unit.size;\n        sprite.width = 12*unit.size;\n        sprite.height = 72*unit.size;\n    }\n\n    return {\n        normalize,\n        update: (newCol, newSprite) => {\n            col = newCol;\n            if (sprite) {\n                sprite.visible = false;\n            }\n            sprite = newSprite;\n            normalize();\n        }\n    };\n};\n\nexport default Highlight;","import * as PIXI from \"pixi.js\";\nimport Cell from \"./Cell\";\nimport Highlight from \"./Highlight\";\n\n\nconst Grid = (state) => {\n    const {offset, stage, unit, score, tiles} = state;\n    const pos = {x: 0, y: 0, w: 50, h:70};\n    const cols = 5;\n    const rows = 8;  // 8 rows but only 7 visible\n    const cells = [];\n    const cellTexture = PIXI.Texture.from('assets/cell.png');\n    const okTexture = PIXI.Texture.from('assets/ok.png');\n    const nokTexture = PIXI.Texture.from('assets/nok.png');\n    const ok = new PIXI.Sprite(okTexture);\n    const nok = new PIXI.Sprite(nokTexture);\n    const highlight = Highlight({offset, ok, nok, unit});\n    let isAnimating = false;\n    let targetIndex = 9;  // 9 is the first target\n\n    stage.addChild(ok);\n    stage.addChild(nok);\n\n    const normalize = () => {\n        pos.x = offset.x + unit.size*5;\n        pos.y = offset.y + unit.size*10;\n        pos.w = unit.size*50;\n        pos.h = unit.size*70;\n    }\n\n    normalize();\n\n    for (let row = 0; row < rows; row++) {\n        cells.push([]);\n        for (let col = 0; col < cols; col++) {\n            cells[row].push(Cell({stage, pos, unit, col, row, cellTexture}));\n        }\n    }\n\n    const lastRow = cells[rows-1];\n\n    lastRow.forEach(cell => cell.hide());\n\n    const resize = () => {\n        normalize();\n        highlight.normalize();\n        cells.forEach(row => row.forEach(cell => cell.resize()));\n    };\n\n    const colOnGrid = (mpos) => {\n        return (\n            mpos.x >= pos.x &&\n            mpos.x < pos.x + pos.w &&\n            mpos.y >= pos.y &&\n            mpos.y < pos.y + pos.h\n        ) ? Math.floor((mpos.x - pos.x) / (10*unit.size)) : null;\n    }\n\n    const colOkNok = (col, tile) => {\n        if (col === null) {\n            return ok;\n        }\n        let cell;\n        for (const row of cells) {\n            if (row === lastRow) {\n                break;\n            }\n            cell = row[col];\n            if (cell === undefined) {\n                console.log(\"undefined cell for col and row: \", col, row);\n                return nok;\n            }\n            if (cell.isEmpty()) {\n                return ok;\n            }\n        }\n        return cell.getIndex() === tile.index ? ok : nok;\n    }\n\n    const select = (mpos, tile) => {\n        if (tile === null) {\n            return;\n        }\n        const col = colOnGrid(mpos);\n        highlight.update(col, colOkNok(col, tile));\n    }\n\n    const final = (mpos, tile, cb) => {\n        const col = colOnGrid(mpos);\n        highlight.update(null);\n        if (col !== null && tile && colOkNok(col, tile) === ok) {\n            cb(col);\n        }\n    }\n\n    const getScore = () => cells.reduce((total, row) => row.reduce((total, cell) => total + cell.getValue(), total), 0);\n    const getMaxIndex = () => cells.reduce((ma, row) => row.reduce((ma, cell) => {\n        const cidx = cell.getIndex();\n        return cidx === null || cidx < ma ? ma : cidx;\n    }, ma), 0);\n    const getMinIndex = () => cells.reduce((mi, row) => row.reduce((mi, cell) => {\n        const cidx = cell.getIndex();\n        return cidx === null || cidx > mi ? mi : cidx;\n    }, mi), 999);\n\n    const cellsToAnimate = [];\n    const colsMoved = [];\n\n    const addMovedCol = col => colsMoved.includes(col) ? null : colsMoved.push(col);\n\n    const processGrid = () => {\n        // we never destoy cells, so do not care about references\n        cellsToAnimate.length = 0;\n\n        // update the score\n        score.update(getScore());\n\n        // calculate if tiles need to move up...\n        const toList = Array(cols).fill(0);\n        for (let r = 0; r < cells.length; r++) {\n            const row = cells[r];\n            for(let i = 0; i < row.length; ++i) {\n                const cell = row[i];\n                if (cell.isEmpty()) {\n                    toList[i] += 1;\n                } else {\n                    const n = toList[i];\n                    if (n > 0) {\n                        addMovedCol(i);\n                        cell.moveTileUp(cells[r-n][i]);\n                        cellsToAnimate.push(cell);\n                    }\n                }\n            }\n        }\n\n        if (cellsToAnimate.length) {\n            return;\n        }\n\n        // Merge check...\n        // console.log('-------')\n        // console.log(colsMoved.join(' - '))\n        for (let r = 0; r < rows-1; r++) {\n            for (const i of colsMoved) {\n                const cell = cells[r][i];\n\n                if (cell.isEmpty()) {\n                    continue;\n                }\n\n                const cellsToCheck = [\n                    {direction: \"right\", ce: i > 0 ? cells[r][i-1] : null},\n                    {direction: \"left\", ce: i < cols-1 ? cells[r][i+1] : null},\n                    {direction: \"up\", ce: cells[r+1][i]}\n                ];\n\n                cellsToCheck.forEach(({direction, ce}) => {\n                    if (ce !== null && !ce.isEmpty() && ce.getIndex() === cell.getIndex()) {\n                        if (direction === \"up\") {\n                            cell.mergeTile(ce, direction);\n                            cellsToAnimate.push(cell);\n                        } else {\n                            ce.mergeTile(cell, direction);\n                            cellsToAnimate.push(ce);\n                        }\n                    }\n\n                });\n            }\n        }\n\n        if (cellsToAnimate.length) {\n            return;\n        }\n\n        // done, get the next tile and reset moved cols\n        // console.log('+++++++')\n        colsMoved.splice(0, colsMoved.length);\n\n        if (getMaxIndex() >= targetIndex) {\n            targetIndex += 2;\n            tiles.nextTarget();\n        }\n        tiles.newTile(getMinIndex());\n    };\n\n    const animate = () => {\n        isAnimating = false;\n        for (const cell of cellsToAnimate) {\n            if (cell.animate() === false) {\n                isAnimating = true;  // not finished animating\n            }\n        }\n        if (!isAnimating && cellsToAnimate.length > 0) {\n            // just finished animating, check for more\n            processGrid();\n        }\n    }\n\n    const addTile = (tile, col) => {\n        const cell = lastRow[col];\n        cell.setTile(tile);\n        addMovedCol(col);\n        processGrid();\n    }\n\n    return {\n        // draw: draw,\n        resize,\n        select,\n        move: select,\n        final,\n        addTile,\n        animate,\n    }\n};\n\nexport default Grid;","import * as PIXI from \"pixi.js\";\n\nconst Tile = (state) => {\n    const {index, allTiles, str, color, unit} = state;\n    const value = 2<<index;\n    const container = new PIXI.Container();\n    // var blur = new PIXI.filters.BlurFilter(0.5);\n    const graphics = new PIXI.Graphics();\n    // graphics.filters = [blur];\n\n    const style = new PIXI.TextStyle({\n        fontFamily: 'Arial',\n        fontSize: 32,\n        fontWeight: 'bold',\n        fill: '#ffffff',\n        align : 'center',\n        stroke: '#ffffff',\n        strokeThickness: 1,\n        lineJoin: 'round',\n    });\n\n    const text = new PIXI.Text(str, style);\n\n    const normalize = (isSmall) => {\n        const size = isSmall === true ? 7*unit.size : 10*unit.size;\n        graphics.clear();\n        graphics.lineStyle(0, color, 1);\n        graphics.beginFill(color, 1);\n        graphics.drawRoundedRect(1, 1, size-2, size-2, 0.5*unit.size);\n        graphics.endFill();\n        text.style.fontSize = isSmall === true ? 2.6*unit.size : 3.6*unit.size;\n        text.position.x = 0.5*size - text.width/2;\n        text.position.y = 0.27*size;\n    }\n\n    container.addChild(graphics);\n    container.addChild(text);\n\n    normalize();\n\n    return {\n        index,\n        value,\n        container,\n        normalize,\n        dupTile: () => Tile({index, allTiles, str, color, unit}),\n        nextTile: () => allTiles[index+1].dupTile(),\n        remove: () => container.parent ? container.parent.removeChild(container) : null,\n    };\n}\n\nexport default Tile;\n","import * as PIXI from \"pixi.js\";\nimport Tile from \"./Tile\";\n\nconst Tiles = (state) => {\n    const {offset, stage, unit} = state;\n\n    const tileRange = 6;\n    const allTiles = [];\n    const numTiles = [\n        '2', '4', '8', '16', '32', '64', '128', '256', '512',\n        '1K', '2K', '4K','8K', '16K', '32K', '64K', '128K', '256K', '512K',\n        '1M', '2M', '4M','8M', '16M', '32M', '64M', '128M', '256M', '512M',\n        '1T', '2T', '4T','8T', '16T', '32T', '64T', '128T', '256T', '512T',\n        '1P', '2P', '4P','8P', '16P', '32P', '64P', '128P', '256P', '512P',\n    ];\n    const rasterTexture = PIXI.Texture.from(\"assets/raster.png\");\n    const currentRaster = new PIXI.Sprite(rasterTexture);\n    const nextRaster = new PIXI.Sprite(rasterTexture);\n\n    let minTileIndex = 0;\n\n    const randColor = (index) => {\n        const red = (Math.floor(Math.random() * 0x50) + ((index&1)?0x20:0x70)) << 16;\n        const green = (Math.floor(Math.random() * 0x50) + ((index&2)?0x20:0x70)) << 8;\n        const blue = (Math.floor(Math.random() * 0x50) + ((index&4)?0x20:0x70)) << 0;\n\n        return red+green+blue;\n    }\n\n    for (let index = 0; index < numTiles.length; ++index) {\n        const color = randColor(index);\n        const str = numTiles[index];\n        // console.log('index: ', index, color.toString(16).padStart(6, 0));\n        allTiles.push(Tile({index, allTiles, str, color, unit}));\n    }\n\n    const renderTiles = () => {\n        let i = 0;\n        for (const tile of allTiles) {\n            stage.addChild(tile.container);\n            tile.container.position.x = 100*Math.floor(i/8);\n            tile.container.position.y = 100*Math.floor(i%8);\n            i++;\n        }\n    }\n\n    const getRandomTile = (mi) => {\n        // Update mi\n        mi = current && current.index < mi ? current.index : mi;\n        let diff;\n        if (mi < minTileIndex) {\n            diff = minTileIndex-mi;\n        } else {\n            diff = 0;\n            mi = minTileIndex;\n        }\n\n        const idx = Math.floor(Math.random() * (tileRange+diff)) + mi;\n        return allTiles[idx].dupTile();\n    }\n\n    let current = null;\n    let next = null;\n\n    const normalizeTiles = () => {\n        if (current) {\n            current.container.position.x = offset.x + unit.size*25;\n            current.container.position.y = offset.y + unit.size*85;\n            current.normalize();\n        }\n        next.container.position.x = offset.x + unit.size*36.5;\n        next.container.position.y = offset.y + unit.size*86.5;\n        next.normalize(true);\n    }\n\n    const normalize = () => {\n        currentRaster.position.x = offset.x + unit.size*24;\n        currentRaster.position.y = offset.y + unit.size*84;\n        currentRaster.width = unit.size*12;\n        currentRaster.height = unit.size*12;\n\n        nextRaster.position.x = offset.x + unit.size*36;\n        nextRaster.position.y = offset.y + unit.size*86;\n        nextRaster.width = unit.size*8;\n        nextRaster.height = unit.size*8;\n\n        normalizeTiles();\n    }\n\n    const newTile = (mi) => {\n        current = next;\n        next = getRandomTile(mi);\n        stage.addChild(next.container);\n        normalizeTiles();\n    };\n\n    stage.addChild(currentRaster);\n    stage.addChild(nextRaster);\n\n    return {\n        tileByIndex: (idx) => {\n            const tile = allTiles[idx].dupTile();\n            stage.addChild(tile.container);\n            return tile;\n        },\n        renderTiles,\n        newTile,\n        getCurrentTile: () => current,\n        stealCurrentTile: () => {\n            const tile = current;\n            current = null;\n            return tile;\n        },\n        resize: normalize,\n        nextTarget: () => minTileIndex++,\n    }\n};\n\nexport default Tiles;","import * as PIXI from \"pixi.js\";\n\nconst Score = (state) => {\n    const {offset, stage, unit} = state;\n\n    const style = new PIXI.TextStyle({\n        fontFamily: 'Arial',\n        fontSize: 32,\n        fontStyle: 'italic',\n        fontWeight: 'bold',\n        fill: '#eeeeee',\n        align : 'center',\n        stroke: '#ffffff',\n        strokeThickness: 2,\n        lineJoin: 'round',\n    });\n\n    const text = new PIXI.Text((0).toLocaleString(), style);\n\n    const normalize = () => {\n        text.x = offset.x + 30*unit.size - text.width/2;\n        text.y = offset.y + 2*unit.size;\n        text.style.fontSize = unit.size*4;\n    }\n\n    stage.addChild(text);\n\n    return {\n        resize: normalize,\n        update: (score) => {\n            const str = (score).toLocaleString();\n            text.text = str;\n            normalize();\n        }\n    };\n}\n\nexport default Score;\n","import './index.css';\nimport * as serviceWorker from './serviceWorker';\nimport Game from \"./Game\";\n\nconst game = Game({\n    container: document.body\n});\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n\nwindow.addEventListener('resize', game.resize);\n\ngame.animate();\n","import * as PIXI from \"pixi.js\";\nimport Grid from \"./Grid\";\nimport Tiles from \"./Tiles\";\nimport Score from \"./Score\";\n\nconst gameTitle = \"Family Block\";\n\nconst Game = (state) => {\n    let container = state.container;\n    let unit = {size: 10}, offset = {x: 0, y: 0};\n\n    const app = new PIXI.Application({\n        width: window.innerWidth,\n        height: window.innerHeight\n    });\n\n    // Add the canvas that Pixi automatically created for you to the HTML document\n    container.appendChild(app.view);\n\n    // Configure app\n    app.renderer.view.style.position = \"absolute\";\n    app.renderer.view.style.display = \"block\";\n    app.renderer.view.style.backgroundColor = \"#823456\";\n    app.renderer.autoResize = true;\n\n    const stage = new PIXI.Container();\n\n    stage.interactive = true;\n\n    const onPointerDown = (event) => {\n        const pos = event.data.getLocalPosition(stage);\n        grid.select(pos, tiles.getCurrentTile());\n    };\n\n    const onPointerMove = (event) => {\n        const pos = event.data.getLocalPosition(stage);\n        grid.move(pos, tiles.getCurrentTile());\n    };\n\n    const placeTile = (col) => {\n        const tile = tiles.stealCurrentTile();\n        if (!tile) {\n            return;\n        }\n\n        grid.addTile(tile, col);\n        grid.animate();\n    }\n\n    const onPointerUp = (event) => {\n        const pos = event.data.getLocalPosition(stage);\n        grid.final(pos, tiles.getCurrentTile(), placeTile);\n    };\n\n    stage\n        .on('pointerdown', onPointerDown)\n        .on('pointermove', onPointerMove)\n        .on('pointerup', onPointerUp);\n\n    const normalize = () => {\n        let ww = window.innerWidth;\n        let wh = window.innerHeight;\n        let nh = wh * (6/10);\n\n        if (ww < nh) {\n            unit.size = ww / 60;\n            offset.x = 0;\n            offset.y = (wh - (unit.size * 100)) / 2;\n        } else {\n            unit.size = wh / 100;\n            offset.x = (ww - (unit.size * 60)) / 2;;\n            offset.y = 0;\n        }\n\n        text.style.fontSize = unit.size * 2.5;\n        text.x = offset.x + unit.size * 16;\n        text.y = offset.y + unit.size * 84;\n    }\n\n    const tiles = Tiles({offset, stage, unit});\n    const score = Score({offset, stage, unit});\n    const grid = Grid({unit, offset, stage, score, tiles});\n\n    const style = new PIXI.TextStyle({\n        fontFamily: 'Arial',\n        dropShadow: true,\n        dropShadowAlpha: 0.8,\n        dropShadowAngle: 2.1,\n        dropShadowBlur: 2,\n        dropShadowColor: '#4a1b7b',\n        dropShadowDistance: 10,\n        fill: ['#ffffff'],\n        stroke: '#8a3bbb',\n        fontSize: 16,\n        fontWeight: 'lighter',\n        lineJoin: 'round',\n        strokeThickness: 11,\n    });\n\n    const text = new PIXI.Text(gameTitle, style);\n    text.skew.set(-0.45, 0.2);\n    text.anchor.set(0.5, -0.5);\n    text.x = 100;\n    text.y = 40;\n    stage.addChild(text);\n\n    tiles.newTile(0);\n    tiles.newTile(0);\n\n    const animate = () => {\n        requestAnimationFrame(animate);\n\n        grid.animate();\n\n        app.renderer.render(stage);\n    }\n\n    // tiles.renderTiles();\n\n    normalize();\n    grid.resize();\n    tiles.resize();\n    score.resize();\n\n    return {\n        resize: () => {\n            normalize();\n            score.resize();\n            grid.resize();\n            tiles.resize();\n            app.renderer.resize(window.innerWidth, window.innerHeight);\n        },\n        animate: animate\n    }\n};\n\n\nexport default Game;"],"sourceRoot":""}